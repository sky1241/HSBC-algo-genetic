### Journal — 2025-10-06

- Contexte: run spécial de comparaison K3/K5/K8 “phase-aware” annuel sans lookahead, 30 seeds × 300 trials (objectif), sorties sur E:. Watcher 3D/heatmaps auto-refresh actif.

- Modifs techniques du jour:
  - Backtest: boucle `iterrows` remplacée par itération index/iloc pour éviter les allocations `DataFrame.values` et réduire les MemoryError.
  - Plage ATR dans l’optimiseur: désormais `atr_mult ∈ [5.0, 25.0]` (pas 0.1) pour concentrer la recherche sur la zone haute où les résultats préliminaires sont meilleurs.
  - Commandes PowerShell robustes: backup vers E:, export des progrès globaux (`RUNS_PROGRESS_CURRENT.csv`), listing des résultats et TOP live depuis les JSONL, relance/auto-ouverture de la 3D.
  - 3D live: `scripts/watch_render_live.py` utilisé avec `--k K3,K5,K8`, `--mdd-max 0.50`, `--min-trades` paramétrable.

- État exécution (14:55 UTC):
  - K3: 1 seed en cours (~71% moy.), JSONL K3 écrits en continu; pas encore de `WFA_phase_*.json` final sur E: (normal tant que la seed n’est pas terminée).
  - K5/K8: JSONL historiques présents; runs de comparaison relancés au besoin.
  - Watcher: relancé et page 3D ouverte automatiquement (`docs/IMAGES/top_trials_live_K3_K5_K8.html`).

- Lecture rapide des meilleures lignes live (filtre intermédiaire trades ≥ 100, MDD ≤ 50% — préliminaire):
  - K3 phase=0: eq_ret ≈ 557.87%, MDD ≈ 39.23%, trades=181, shift=5, ATR≈14.2
  - K5 phase=2: eq_ret ≈ 465.03%, MDD ≈ 18.24%, trades=103, shift=16, ATR=11.3
  - K3 phase=2: eq_ret ≈ 244.63%, MDD ≈ 12.45%, trades=139, shift=31, ATR=13.3

- Impact attendu:
  - Réduction des plantages mémoire pendant WFA (boucle backtest).
  - Focalisation de l’exploration paramétrique ATR sur la zone pertinente (≥ 5.0), sans allonger la durée (même n_trials, pruner ASHA inchangé).
  - Suivi et visualisation en temps réel stabilisés (3D + heatmaps) et sauvegardes E: fiables.

- Prochaines étapes:
  - Laisser aboutir les seeds K3/K5/K8; passer au tri “stable” (MDD ≤ 50%, ≥ 280 trades) et produire `BEST_*_TOP10.csv`.
  - Figer presets par phase (médianes multi-seeds) et valider OOS.
  - Option: run de “raffinage ATR” fin autour du meilleur (span 2.0–2.5, step 0.05) si nécessaire.


