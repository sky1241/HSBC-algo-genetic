## Journal - 2026-02-07

### Contexte
Lancement analyse K5 30 seeds avec correction critique: passage de K5 H2 pur vers K5 1D stable (comme K3).

### Probleme Identifie

#### K5 H2 Pur = CATASTROPHE
Les anciens runs K5 utilisaient `K5.csv` (labels H2 purs) et resultaient en **ruine totale (-100%)** sur tous les seeds testes (1-5).

| Seed | Equity | MDD | Trades |
|------|--------|-----|--------|
| seed_1 | -100% | 0% | 0 |
| seed_2 | -100% | 0% | 0 |
| seed_3 | -100% | 0% | 0 |
| seed_4 | -100% | 0% | 0 |

**Cause:** Trop de switches de phase (jusqu'a 12/jour) causant du whipsaw destructeur.

### Solution Appliquee

#### Generation K5_1d_stable.csv
Utilisation du script `downsample_labels_2h_to_1d.py --k 5` pour creer des labels stabilises:

```
Stats originales (2h):
- Lignes: 60,531
- Changements de phase: 847 (1.40%)

Stats apres downsampling 1D stable:
- Changements de phase: 743 (1.23%)
- Reduction: 12.3%
- Switches/jour moyen: 0.15 (vs 12/jour avant)

Distribution phases K5 1D stable:
- Phase 0: 23.6%
- Phase 1: 17.3%
- Phase 2: 32.8%
- Phase 3: 8.7%
- Phase 4: 17.7%
```

#### Modification Script Lancement
```powershell
# Avant (H2 pur - ruine)
$LABELS_CSV = "K5.csv"

# Apres (1D stable - survie)
$LABELS_CSV = "K5_1d_stable.csv"
```

### Test Rapide (3 seeds, 10 trials)

| Seed | Equity | MDD | Trades | Survie |
|------|--------|-----|--------|--------|
| 997 | **+51.2%** | 9.2% | 294 | OUI |
| 998 | -13.6% | 17.0% | 334 | OUI |
| 999 | -6.3% | 11.0% | 291 | OUI |

**Verdict:**
- Survie 100% (vs 0% avec H2 pur)
- **Seed 997 = +51.2%** meme avec seulement 10 trials!
- Variance elevee entre seeds (normal avec peu de trials)
- 300 trials donneront des resultats plus consistants comme K3

### Systemes Valides

#### Checkpoint Manager
- Sauvegarde automatique toutes les 5 minutes
- Fichiers `CHECKPOINT.json` crees dans chaque seed
- Permet reprise apres interruption

#### Progress Tracking
- Fichiers `PROGRESS.json` mis a jour en temps reel
- Format: `{"folds_done": X, "folds_total": 14, "trial": Y, "percent": Z}`

#### Continuous Learning (disponible)
- Module `src/continuous_learning.py` pret
- Permet refit HMM et reoptimisation sur nouvelles donnees

### Comparaison K3 vs K5

| Aspect | K3 1D Stable | K5 H2 Pur | K5 1D Stable |
|--------|--------------|-----------|--------------|
| Labels | K3_1d_stable.csv | K5.csv | K5_1d_stable.csv |
| Switches/jour | 0.04 | ~12 | 0.15 |
| Survie | 100% | 0% | 100% |
| Monthly (300t) | +0.30% | N/A (ruine) | A tester |
| MDD | ~12% | 100% | ~12-17% |

### Fichiers Modifies/Crees

- `outputs/fourier/labels_frozen/BTC_FUSED_2h/K5_1d_stable.csv` (NOUVEAU)
- `scripts/launch_30_seeds_k5.ps1` (MODIFIE - pointe vers K5_1d_stable)
- `outputs/wfa_phase_k5_test/` (test rapide 3 seeds)

### Prochaines Etapes

1. **Lancer 30 seeds K5 1D stable** (300 trials chacun)
   ```powershell
   .\scripts\launch_30_seeds_k5.ps1
   ```
   Duree estimee: 20-30 heures

2. **Comparer resultats K5 vs K3**
   - Objectif: monthly ~0.30%, MDD <15%, 100% survie

3. **Si K5 valide:** Generer K8_1d_stable et tester

### Lecons Apprises

1. **Labels H2 purs = danger pour K5+**
   - Plus de phases = plus de switches = plus de whipsaw
   - K3 (3 phases) tolere mieux que K5 (5 phases)

2. **1D stable = solution universelle**
   - Appliquer systematiquement a K5/K8/K10
   - Reduction switches de 90%+

3. **Test rapide avant production**
   - 10 trials suffit pour valider survie
   - Evite de gaspiller 30h sur config cassee

### Temps Passe
- Diagnostic K5 H2 pur: ~30min
- Generation K5_1d_stable: ~5min
- Test rapide 3 seeds: ~2h30
- Documentation: ~30min
- **Total: ~3h30**

---
**Derniere mise a jour:** 2026-02-07 16:15 UTC+1
