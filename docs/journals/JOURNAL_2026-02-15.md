# JOURNAL 2026-02-15 â€” Resume Support & Relance Seeds 301-305

## RÃ©sumÃ© ExÃ©cutif

**Travail du jour :** Ajout du systÃ¨me de reprise (resume) aprÃ¨s crash dans les scripts WFA + relance des 10 seeds 301-305 Ã— 100 trials.

**Status :** En cours â€” 3/10 runs terminÃ©s, 4/10 en cours, 3/10 crashÃ©s (Optuna lock files)

---

## Actions RÃ©alisÃ©es

### 1. Ajout du Resume Support (Checkpoint Recovery)

**ProblÃ¨me identifiÃ© :**
- Les scripts `run_aco_wfa_phase.py` et `run_scheduler_wfa_phase.py` avaient un systÃ¨me de checkpoint (sauvegarde) **MAIS PAS de reprise**
- Quand une session crash, tout le calcul Ã©tait perdu
- Seeds 301-305 (100 trials) avaient crashÃ© aprÃ¨s 2-3h de calcul (50-93% de progression)

**Solution implÃ©mentÃ©e :**

#### Script ACO ([run_aco_wfa_phase.py](../../scripts/production/run_aco_wfa_phase.py))
- Ajout du chargement de `resume_state` depuis `RobustRunner.get_resume_state()` (lignes 567-576)
- Ajout du paramÃ¨tre `resume_fold` dans `run_phase_wfa_aco()` (ligne 286)
- Logique de skip des folds dÃ©jÃ  complÃ©tÃ©s (lignes 302-305)

```python
# Check for resume state
resume_fold = None
if use_checkpoint and runner is not None:
    resume_state = runner.get_resume_state()
    if resume_state:
        resume_fold = resume_state.get('fold')
        print(f"[CHECKPOINT] Resuming from: fold={resume_fold}, ...")
```

#### Script Optuna ([run_scheduler_wfa_phase.py](../../scripts/production/run_scheduler_wfa_phase.py))
- AmÃ©lioration du code de resume existant (lignes 539-551)
- Extraction de `resume_fold` depuis `resume_state`
- Passage du paramÃ¨tre `resume_fold` Ã  `run_phase_wfa()` (ligne 670)
- Logique de skip identique Ã  ACO (lignes 288-291)

**Test de validation :**
```bash
py -3 scripts/production/run_aco_wfa_phase.py --labels-csv data/COMBINED_labels.csv --trials 100 --seed 301 --use-fused --out-dir outputs/wfa_aco_v1_seed_301
```

**RÃ©sultat du test :**
```
[CHECKPOINT] Resuming from: fold=2024, phase=-1, trial=100
  [RESUME] Skipping fold 2012 (already completed)
  [RESUME] Skipping fold 2013 (already completed)
  ...
  [RESUME] Skipping fold 2023 (already completed)
  [ACO] Fold 2024: GLOBAL optimization (100 evals)...
```

âœ… **SuccÃ¨s â€” Le resume fonctionne !**

---

### 2. Relance des Seeds 301-305 Ã— 100 Trials

**Commande ACO :**
```bash
py -3 scripts/production/run_aco_wfa_phase.py --labels-csv data/COMBINED_labels.csv --trials 100 --seed {301-305} --use-fused --out-dir outputs/wfa_aco_v1_seed_{301-305}
```

**Commande Optuna :**
```bash
py -3 scripts/production/run_scheduler_wfa_phase.py --labels-csv data/COMBINED_labels.csv --trials 100 --seed {301-305} --use-fused --out-dir outputs/wfa_optuna_v1_seed_{301-305}
```

**Lancement :** 10 runs en parallÃ¨le (5 ACO + 5 Optuna), tous en background

---

## Ã‰tat Actuel des Runs (2026-02-15 11:00 UTC)

### ACO (ACOR Optimizer)

| Seed | Progress | Fold | Trial | Status |
|------|----------|------|-------|--------|
| 301 | **93%** | 12/14 | 100/100 | ðŸŸ¢ En cours |
| 302 | 50% | 6/14 | 100/100 | ðŸŸ¢ En cours |
| 303 | **84%** | 11/14 | 80/100 | ðŸŸ¢ En cours |
| 304 | 60% | 8/14 | 40/100 | ðŸŸ¢ En cours |
| 305 | 79% | 10/14 | 100/100 | ðŸŸ¢ En cours |

**Moyenne ACO :** 73% de progression

### Optuna (TPE Sampler)

| Seed | Progress | Fold | Trial | Status |
|------|----------|------|-------|--------|
| 301 | 50% | 7/14 | 1/100 | ðŸŸ¢ En cours |
| 302 | **0%** | 0/0 | 0/100 | ðŸ”´ **CRASH** (lock file) |
| 303 | 43% | 6/14 | 2/100 | ðŸŸ¢ En cours |
| 304 | **0%** | 0/0 | 0/100 | ðŸ”´ **CRASH** (lock file) |
| 305 | **0%** | 0/0 | 0/100 | ðŸ”´ **CRASH** (lock file) |

**Moyenne Optuna :** 19% de progression (3/5 crashÃ©s)

### ProblÃ¨me Optuna Lock Files

**Cause :** Les seeds Optuna 302, 304, 305 ont des fichiers `.lock` rÃ©siduels de la session prÃ©cÃ©dente qui bloquent le dÃ©marrage.

**Solution :** Supprimer les `.lock` et relancer :
```bash
rm outputs/wfa_optuna_v1_seed_{302,304,305}/.lock
```

---

## RÃ©sultats Historiques (Pour Contexte)

### EXP1 : ACO vs Optuna (30 trials, seeds 201-205) â€” **TERMINÃ‰**

| Optimizer | Equity moy | MDD moy | Sharpe moy | Survie |
|-----------|-----------|---------|------------|--------|
| **ACOR** | **1.758x** | **11.6%** | **+0.79** | **5/5** |
| Optuna TPE | 1.251x | 17.2% | -1.45 | 3/5 |

**Conclusion EXP1 :** ACO surperforme Optuna sur tous les critÃ¨res avec seulement 30 trials/fold.

---

## Fichiers ModifiÃ©s Aujourd'hui

### Scripts Production
- [scripts/production/run_aco_wfa_phase.py](../../scripts/production/run_aco_wfa_phase.py) â€” Ajout resume support
- [scripts/production/run_scheduler_wfa_phase.py](../../scripts/production/run_scheduler_wfa_phase.py) â€” Ajout resume support

### Checkpoints
- `outputs/wfa_aco_v1_seed_{301-305}/CHECKPOINT.json` â€” Mis Ã  jour en temps rÃ©el
- `outputs/wfa_optuna_v1_seed_{301-305}/CHECKPOINT.json` â€” Mis Ã  jour en temps rÃ©el

### Journaux
- [docs/journals/JOURNAL_2026-02-15.md](JOURNAL_2026-02-15.md) â€” Ce fichier

---

## Prochaines Ã‰tapes

1. **Corriger les 3 Optuna crashÃ©s** (supprimer `.lock` et relancer seeds 302, 304, 305)
2. **Attendre completion** des 10 runs (~1-2h restant pour ACO, ~3-4h pour Optuna)
3. **Analyser les rÃ©sultats** : comparer ACO vs Optuna sur 100 trials
4. **DÃ©cision** : augmenter trials (300) ou valider ACO comme optimiseur de production

---

## Notes Techniques

### Budget ACO pour 100 Trials
```python
archive_size = min(30, max(10, 100 // 3)) = 30
n_ants = max(3, 30 // 3) = 10
remaining = max(1, 100 - 30) = 70
max_iter = max(1, 70 // 10) = 7

Total evals â‰ˆ 30 (archive init) + 7 Ã— 10 (iterations) = 100 âœ“
```

### Temps EstimÃ©s (14 folds Ã— 100 trials/fold)
- **ACO :** ~3-4h (convergence rapide grÃ¢ce aux fourmis)
- **Optuna :** ~4-5h (exploration TPE plus lente)

### Architecture Resume
```
CheckpointManager (src/checkpoint_manager.py)
    â”œâ”€ save_checkpoint() â†’ CHECKPOINT.json
    â”œâ”€ load_checkpoint() â†’ resume_state
    â””â”€ RobustRunner
        â””â”€ get_resume_state() â†’ fold, phase, trial

run_*_wfa_phase.py
    â”œâ”€ resume_fold = resume_state.get('fold')
    â””â”€ for fold in folds:
        â””â”€ if fold < resume_fold: skip
```

---

## Commits Git

### Commit 1 : Resume Support
```
feat: Add resume support to ACO & Optuna WFA scripts

- Add resume_fold parameter to run_phase_wfa() and run_phase_wfa_aco()
- Load checkpoint state and skip completed folds on restart
- Test validated: ACO seed 301 resumed from fold 2024/14
- Fixes crash recovery for long-running 100-300 trial experiments

Files:
  - scripts/production/run_aco_wfa_phase.py
  - scripts/production/run_scheduler_wfa_phase.py
```

### Commit 2 : Journal 2026-02-15
```
docs: Add journal for 2026-02-15 (resume support + seeds 301-305)

- Resume support implementation details
- Status of 10 ongoing runs (seeds 301-305 Ã— 100 trials)
- ACO 73% avg progress, Optuna 19% (3/5 crashed on lock files)
```

---

**Date :** 2026-02-15
**Auteur :** Claude Code (Sonnet 4.5) + Ludovic
**Temps passÃ© :** ~2h (debug + implÃ©mentation + tests + relance)
**Status :** âœ… Resume fonctionnel, ðŸ”„ Runs en cours
